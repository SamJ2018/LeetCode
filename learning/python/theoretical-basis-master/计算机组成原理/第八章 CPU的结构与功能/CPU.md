## CPU的结构

### CPU的功能

- 控制器的功能    指令控制、操作控制、时间控制、处理中断、数据加工
  - 指令控制  PC IR
  - 操作控制   CU
  - 时间控制   CU
  - 处理中断  ALU寄存器
  - 数据加工   中断系统
- 运算器的功能
  - 实现算术运算和逻辑运算

### CPU的结构框图

![1550317615454](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550317615454.png)

### CPU的寄存器

#### 分类

- 用户可见寄存器
  - 通用寄存器   存放操作数
  - 数据寄存器   存放操作数（满足各种数据类型）
  - 地址寄存器    存放地址，其位数应满足最大的地址范围
  - 条件码寄存器   存放条件码
- 控制和状态寄存器
  - 控制寄存器
  - 状态寄存器 

### 控制单元CU和中断系统

- CU    产生全部指令的微操作命令序列
  - 设计方法
    - 组合逻辑设计    硬连线逻辑
    - 微程序设计        存储逻辑
- 中断系统

### ALU 

第六章内容。

## 指令周期

### 指令周期的基本概念

#### 指令周期

取出并执行一条指令所需的全部时间。

完成一条指令

- 取值、分析    取值周期
- 执行    执行周期

#### CPU工作周期的标志

CPU访存有四种性质

- 取指令   
- 取地址    
- 存取操作数或结果
- 存程序断点

### 指令周期的数据流

- 取值周期数据流
  - ![1550318589791](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550318589791.png)
- 间址周期数据流
  - ![1550318669956](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550318669956.png)
- 执行周期数据流
  - 不同指令的执行周期数据流不同
- 中断周期数据流
  - 保存程序断点
    - ![1550318776629](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550318776629.png)

## 指令流水 

### 如何提高机器速度

#### 提高访存速度

- 高速芯片  
- Cache
- 多体并行

#### 提高I/O和主机之间的传送熟读

- 中断
- DMA
- 通道
- I/O处理机
- 多总线

#### 提高运算器速度

- 高速芯片
- 改进算法
- 快速进位链

### 系统的并行性

- 并行
  - 并发    两个或两个以上事件在同一时间段发生
  - 同时    两个或两个以上事件在同一时刻发生
- 等级
  - 过程级
    - 粗粒度   软件实现
  - 指令级
    - 细粒度    硬件实现

### 指令流水原理

#### 指令的串行执行

#### 指令的二级流水

#### 影响指令流水效率加倍的因素

- 执行时间＞取值时间
- 条件转移指令堆指令流水的影响
  - 必须等上条指令执行结束，才能确定下条指令的地址  造成时间损失  
    - 解决办法：猜测法

#### 指令的六级流水

#### 影响指令流水线性能的因素

- 结构相关   不同指令争用同一功能部件产生资源冲突
  - 解决办法
    - 停顿
    - 指令存储器和数据存储器分开
    - 指令预取技术
- 数据相关    不同指令因重叠操作，可能改变操作数的读/写访问顺序
  - 写后读相关
    - 举例
    - ![1550319647779](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550319647779.png)
  - 读后写相关
    - 举例
    - ![1550319667584](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550319667584.png)
  - 写后写相关
    - 举例
    - ![1550319681725](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1550319681725.png)
- 解决办法
  - 后推法
  - 采用旁路技术
- 控制相关
  - 由转移指令引起

### 流水线性能

#### 吞吐率

单位时间内流水线所完成指令或输出结果的数量。

#### 加速比

M段的流水线速度与等功能的非流水线的速度之比。

#### 效率

流水线中各功能段的利用率。

### 流水线的多发技术

#### 超标量技术

- 每个时钟周期内可并发多条独立指令。
- 不能调整指令的执行顺序

#### 超流水线技术

- 在一个时钟周期内再分段

#### 超长指令字技术

- 由编译程序挖掘出指令间潜在的并行性

### 流水线结构

- 指令流水线结构
- 运算流水线结构

## 中断系统

### 概述

#### 引起中断的各种因素

- 认为设置的中断
- 程序性事故
- 硬件故障
- I/O设备
- 外部事件

#### 中断系统需解决的问题

- 各中断源如何向CPU提出请求？
- 各中断源同时提出请求怎么办？
- CPU什么条件、什么时间、以什么方式响应中断？
- 如何保护现场？
- 如何寻找入口地址？
- 如何恢复现场，如何返回？
- 处理中断的过程中又出现新的中断桌面办？

### 中断请求标记和中断判优逻辑

#### 中断请求标记  INTR

 INTR 分散再各个中断源的接口电路中

INTR 集中在CPU的中断系统内

#### 中断判优逻辑

##### 硬件实现（排队器）

- 分散在各个中断源的接口电路中   链式排队器
- 集中在CPU内

##### 软件实现（程序查询）

### 中断服务程序入口地址的寻找

##### 硬件向量法

##### 软件查询法

### 中断响应

- 响应中断的条件
- 响应中断的时间
- 中断隐指令
  - 保护程序断电
  - 寻找服务程序入口地址
  - 硬件关中断

### 保护现场和恢复现场

- 保护现场
  - 断电     中断隐指令完成
  - 寄存器内容    中断服务程序完成
- 恢复现场   中断服务程序完成

### 多重中断

#### 实现多重中断条件

- 提前设置开中断指令
- 优先级别高的中断源有权中断优先级别低的中断源

#### 屏蔽技术

